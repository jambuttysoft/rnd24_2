# Анализ экспериментов из исследования "Consensus Method for Data Reliability"

## Глава 1: Что было нужно для исследования

### Цели и задачи
- **Основная потребность**: Создание надежной базы данных поставщиков в условиях отсутствия централизованных публичных баз данных компаний на Филиппинах
- **Техническая задача**: Разработка системы для агрегации и валидации данных из оцифрованных кассовых чеков
- **Методологическая цель**: Формализация и валидация метода консенсуса для определения надежности данных
- **Практическая необходимость**: Нормализация и стандартизация информации о поставщиках (TIN, название, адрес)

### Проблемы, которые нужно было решить
- Отсутствие централизованной базы данных компаний на Филиппинах
- Ненадежность данных от сторонних провайдеров
- Несогласованность форматов данных в кассовых чеках
- Необходимость автоматической верификации поставщиков

## Глава 2: Эксперименты с начальным сбором данных (Initial Data Collection)

### Что было нужно
- **Система сбора данных**: Автоматизированный процесс извлечения данных из кассовых чеков
- **Технологии**: OCR (оптическое распознавание символов) или ручной ввод
- **База данных**: Гибкая схема для хранения неструктурированных данных
- **Примеры данных**: Реальные филиппинские компании для демонстрации вариативности

### Проблемы, с которыми столкнулись

#### 1. Вариативность форматов TIN
- **Проблема**: TIN появлялись в разных форматах (с дефисами и без: "002-040-000" vs "002040000")
- **Дополнительная сложность**: Некоторые записи включали суффиксы филиалов ("-000")
- **Ошибки**: Неполные TIN из-за ошибок OCR (например, "000-456-78" вместо полного номера)

#### 2. Несогласованность названий компаний
- **Проблема**: Одна компания могла быть записана как:
  - Полное название: "San Miguel Corporation"
  - Аббревиатура: "SMC"
  - Частичное название: "San Miguel Corp."
  - Вариации: "San Miguel Corporation Inc."

#### 3. Различия в адресах
- **Проблема**: Адреса варьировались по:
  - Формату улиц: "San Miguel Avenue" vs "San Miguel Ave"
  - Сокращениям городов: "Mandaluyong City" vs "Mandaluyong"
  - Включению почтовых кодов: с "1550" и без
  - Региональным обозначениям: "Metro Manila" vs "MM"

#### 4. Многоязычные данные
- **Проблема**: Смешение английского и филиппинского языков
- **Пример**: "Banco de Oro Unibank" vs "BDO Unibank"

### Как решались проблемы

#### 1. Нормализация TIN
- **Решение**: Конвертация всех TIN в стандартный формат (9 цифр без дефисов)
- **Валидация**: Проверка длины TIN при вводе
- **Обнаружение ошибок**: Алгоритмы для выявления аномалий

#### 2. Стандартизация названий
- **Решение**: Использование fuzzy matching и NLP техник
- **Методы**: Группировка похожих названий под одним каноническим именем
- **Многоязычность**: Применение многоязычных NLP моделей или инструментов перевода

#### 3. Нормализация адресов
- **Решение**: Парсинг адресов на компоненты (номер дома, улица, город, регион, почтовый код)
- **Стандартизация**: Расширение сокращений с использованием филиппинских правил
- **Regex**: Использование регулярных выражений для извлечения и нормализации

#### 4. Гибкая схема хранения
- **Решение**: Использование текстовых полей без начальных ограничений формата
- **Структура**: Receipt ID, TIN, Company Name, Address, Timestamp
- **Масштабируемость**: PostgreSQL с индексацией по TIN

## Глава 3: Эксперименты с методологией консенсуса (Queue Management & Consensus)

### Что было нужно
- **Система очередей**: Управление обработкой TIN, достигших порога консенсуса (≥5 записей)
- **Алгоритмы сравнения**: Методы для определения сходства названий и адресов
- **Механизм консенсуса**: Правила для выбора наиболее надежных данных
- **Обработка ошибок**: Система для работы с неудачными процессами

### Проблемы, с которыми столкнулись

#### 1. Управление очередями
- **Проблема**: Необходимость эффективной и масштабируемой обработки больших объемов данных
- **Сложность**: Предотвращение перегрузки при высокоинтенсивном поступлении данных
- **Отказоустойчивость**: Обработка сбоев в процессе консенсуса

#### 2. Определение сходства названий
- **Проблема**: Количественная оценка различий между вариантами названий
- **Сложность**: Обработка аббревиатур и многоязычных элементов
- **Пороговые значения**: Определение оптимального порога сходства (>80%)

#### 3. Консенсус по адресам
- **Проблема**: Структурированная природа адресов и их вариативность
- **Сложность**: Отсутствующие компоненты адресов
- **Стандартизация**: Необходимость филиппинских правил для сокращений

### Как решались проблемы

#### 1. Система управления очередями
- **Решение**: Использование message queuing систем (RabbitMQ, Apache Kafka)
- **Альтернатива**: Таблица базы данных для простых реализаций
- **Процесс**: 
  - Нормализация TIN после вставки данных
  - Проверка количества записей
  - Добавление в очередь при достижении порога (≥5)
- **Обработка ошибок**: Dead-letter queues для неудачных процессов
- **Масштабируемость**: Распределение очередей между несколькими воркерами

#### 2. Алгоритмы консенсуса для названий
- **Нормализация**:
  - Конвертация в нижний регистр
  - Удаление пунктуации и стоп-слов
  - Расширение сокращений через словарь
- **Сравнение сходства**:
  - Levenshtein distance
  - Jaro-Winkler similarity
  - Порог сходства >80%
- **Определение консенсуса**:
  - Frequency-Based Voting (выбор наиболее частого)
  - Hierarchical clustering
  - Синтез для полноты информации

#### 3. Алгоритмы консенсуса для адресов
- **Парсинг и нормализация**:
  - Разбор на компоненты (номер дома, улица, город, регион, почтовый код)
  - Стандартизация каждого компонента
  - Использование regex для извлечения
- **Консенсус**:
  - Frequency voting для каждого компонента
  - Приоритет более полным адресам
  - Синтез из дополняющих вариантов

#### 4. Практический пример консенсуса
**San Miguel Corporation**:
- Варианты: "San Miguel Corporation" (2 раза), "SMC" (1), "San Miguel Corp." (1), "San Miguel" (1)
- Результат консенсуса: "San Miguel Corporation" (наиболее частый и полный)
- Обоснование: Кластеризация группирует все как варианты, частотное голосование выбирает полное название

## Заключение

Исследование продемонстрировало успешную разработку и тестирование системы консенсуса для определения надежности данных в условиях отсутствия централизованных баз данных. Основные достижения:

1. **Решена проблема вариативности данных** через нормализацию и стандартизацию
2. **Создана масштабируемая система очередей** для обработки больших объемов данных
3. **Разработаны эффективные алгоритмы консенсуса** для названий и адресов компаний
4. **Продемонстрирована практическая применимость** на реальных филиппинских компаниях

Система показала способность автоматически создавать надежные записи о поставщиках из неструктурированных данных кассовых чеков, что критически важно для рынков с ограниченной инфраструктурой данных.